# Eventa - ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

Eventaã¯æœ€æ–°æŠ€è¡“ã‚’ä½¿ç”¨ã—ãŸé«˜æ€§èƒ½ãªã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯Rails APIã¨Next.jsãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

è©³ç´°ãªæƒ…å ±ã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

- [é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨åŸºæœ¬æ“ä½œ](docs/development.md)
- [æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †](docs/deployment.md)
- [Dockerç’°å¢ƒã®è©³ç´°èª¬æ˜](docs/docker.md)

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

```bash
# é–‹ç™ºç’°å¢ƒèµ·å‹•
make dev

# APIç¢ºèª
curl http://localhost:3001/healthz
```

## ğŸ”§ é–‹ç™ºç’°å¢ƒã®ä»•æ§˜

- **Ruby**: 3.3
- **Rails**: 8.0
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: MySQL 8.0
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥/ã‚¸ãƒ§ãƒ–**: Redis 7 + Sidekiq
- **ã‚³ãƒ¼ãƒ‰å“è³ª**: Standard (Rubocopãƒ™ãƒ¼ã‚¹ã®çµ±ä¸€ã‚¹ã‚¿ã‚¤ãƒ«)

## ğŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

- `api/`: Ruby on Rails API
- `frontend/`: Next.js ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (å®Ÿè£…äºˆå®š)
- `docs/`: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- `Makefile`: å…±é€šã‚³ãƒãƒ³ãƒ‰
- `docker-compose.yml`: é–‹ç™ºç’°å¢ƒè¨­å®š

## ğŸ“ Dockerç’°å¢ƒã®ç‰¹è¨˜äº‹é …

### .dockerignore ã¨é–‹ç™º/æœ¬ç•ªç’°å¢ƒã®é•ã„

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚µã‚¤ã‚ºæœ€é©åŒ–ã®ãŸã‚ã€`.dockerignore`ã§`api/spec/`ã¨`api/tmp/`ã‚’é™¤å¤–ã—ã¦ã„ã¾ã™ã€‚ã“ã®çµæœï¼š

- **æœ¬ç•ªç’°å¢ƒå‘ã‘Dockerã‚¤ãƒ¡ãƒ¼ã‚¸**: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¯å«ã¾ã‚Œãªã„è»½é‡ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã«ãªã‚Šã¾ã™
- **é–‹ç™ºç’°å¢ƒ**: `docker-compose.yml`ã®`volumes`ãƒã‚¦ãƒ³ãƒˆã«ã‚ˆã‚Šã€`api/spec`ã¯ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™
- **CIç’°å¢ƒ**: GitHub Actionsã§ã¯ã€ã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ãŸã‚‚ã®ã«å¯¾ã—ã¦ç›´æ¥ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚å½±éŸ¿ã‚ã‚Šã¾ã›ã‚“

**æ³¨æ„**: ã‚‚ã—Dockerå†…ã§`bundle exec rspec`ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã€ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®æ–¹æ³•ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼š
1. é–‹ç™ºç’°å¢ƒã§ã¯`docker compose exec api bundle exec rspec`ï¼ˆãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆã«ã‚ˆã‚Š`spec`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
2. ç‹¬è‡ªã®CIç’°å¢ƒã§Dockerãƒ“ãƒ«ãƒ‰ã¨åŒæ™‚ã«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã¯ã€ä¸€æ™‚çš„ã«`.dockerignore`ã‹ã‚‰`api/spec`ã‚’é™¤å¤–ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

### Node.jsä¾å­˜æ€§

æœ¬ç•ªç’°å¢ƒã§ã‚‚CSSã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç­‰ã®ãŸã‚ã«Node.jsãŒå¿…è¦ãªãŸã‚ã€`Dockerfile.api`ã®runtimeã‚¹ãƒ†ãƒ¼ã‚¸ã«ã¯`nodejs`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å«ã‚ã¦ã„ã¾ã™ã€‚

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

RSpecã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ:

```bash
make test
```

ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯:

```bash
make lint
```

> **æ³¨æ„**: ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€Rubocopã®ç›´æ¥ä½¿ç”¨ã§ã¯ãªãã€Standardã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚Standardã¯ä¸€è²«ã—ãŸã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ã™ã‚‹Rubocopãƒ™ãƒ¼ã‚¹ã®ãƒ„ãƒ¼ãƒ«ã§ã€è¨­å®šã®è¤‡é›‘ã•ã‚’è»½æ¸›ã—ã¾ã™ã€‚`make lint`ã‚³ãƒãƒ³ãƒ‰ã¯Standardã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

## ğŸ”’ ç’°å¢ƒå¤‰æ•°

`.env.example`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ã€1Password CLIãªã©ã®å®‰å…¨ãªæ–¹æ³•ã§ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

## ğŸš¢ ãƒ‡ãƒ—ãƒ­ã‚¤

GitHub Actionsã¨Argo Rolloutsã‚’ä½¿ç”¨ã—ãŸCI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

### Argo Rolloutsã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤

Argo Rolloutsã¯ã€Kubernetesã«ãŠã‘ã‚‹é€²è¡Œçš„ãƒ‡ãƒªãƒãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ä»¥ä¸‹ã«ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã®ä¾‹ã‚’ç¤ºã—ã¾ã™ï¼š

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  name: eventa-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: eventa-api
  template:
    metadata:
      labels:
        app: eventa-api
    spec:
      containers:
      - name: eventa-api
        image: eventa-api:latest
        ports:
        - containerPort: 3000
        env:
        - name: RAILS_ENV
          value: production
        - name: GIT_SHA
          value: "{{.Values.gitSha}}"
  strategy:
    canary:
      steps:
      - setWeight: 20
      - pause: {duration: 5m}
      - setWeight: 50
      - pause: {duration: 5m}
```

ã“ã®è¨­å®šã«ã‚ˆã‚Šã€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯æœ€åˆã«20%ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’å—ã‘ã€5åˆ†å¾Œã«50%ã«å¢—åŠ ã€ã•ã‚‰ã«5åˆ†å¾Œã«100%ã¨ãªã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã®ãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## â“ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

- **API 502 ã‚¨ãƒ©ãƒ¼**: MySQLã®èµ·å‹•å‰ã«RailsãŒç«‹ã¡ä¸ŠãŒã£ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`docker compose restart api`ã§è§£æ±ºã—ã¾ã™ã€‚
- **ä¾å­˜é–¢ä¿‚ã®ã‚¨ãƒ©ãƒ¼**: `make dev`ã‚’å†å®Ÿè¡Œã™ã‚‹ã‹ã€`docker compose exec api bundle install`ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

### macOSï¼ˆç‰¹ã«Apple Siliconï¼‰ã§ã®mysql2 gemä¾å­˜é–¢ä¿‚

macOSãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§`bundle install`ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã€mysql2 gemãŒMySQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ˜ãƒƒãƒ€ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œãšã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚è§£æ±ºæ–¹æ³•ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ï¼š

#### ç‹é“ã®è§£æ±ºç­–ï¼ˆæ¨å¥¨ï¼‰ï¼š

```bash
# 1) ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
brew install mysql@8 openssl@3

# 2) PATHã‚’é€šã™
echo 'export PATH="/opt/homebrew/opt/mysql@8/bin:$PATH"' >> ~/.zprofile
source ~/.zprofile

# 3) mysql2ãƒ“ãƒ«ãƒ‰è¨­å®šã‚’è¿½åŠ 
bundle config --local build.mysql2 \
  "--with-mysql-dir=$(brew --prefix mysql@8) \
   --with-openssl-dir=$(brew --prefix openssl@3)"

# 4) å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
bundle install
```

#### æœ€é€Ÿã®è§£æ±ºç­–ï¼š

ã™ã¹ã¦Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§è¡Œã†ã“ã¨ã§å•é¡Œã‚’å›é¿ã§ãã¾ã™ï¼š

```bash
# Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
docker compose exec api bundle exec rails ...
```

#### ãã®ä»–ã®è§£æ¶ˆæ–¹æ³•ï¼š

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æœ€å°é™ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å ´åˆï¼š

```bash
brew install mysql-client
bundle config --local build.mysql2 "--with-mysql-dir=$(brew --prefix mysql-client)"
bundle install
```

## ğŸ¤ è²¢çŒ®

1. æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ (`git checkout -b feature/amazing-feature`)
2. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ (`git commit -m 'Add some amazing feature'`)
3. ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒ—ãƒƒã‚·ãƒ¥ (`git push origin feature/amazing-feature`)
4. Pull Requestã‚’ä½œæˆ

---

Â© 2025 Eventa Team
