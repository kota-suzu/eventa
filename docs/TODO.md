# ドキュメンテーション関連TODOリスト

## API仕様書

<!-- TODO(!documentation!urgent): API仕様書の完成と更新
- 全エンドポイントの詳細な仕様（パラメータ、レスポンス、エラーコード）を追加
- リクエスト/レスポンス例の追加
- 認証方式の詳細なドキュメント化
- Swagger/OpenAPIへの移行検討
-->

## エラー体系

<!-- TODO(!documentation): エラーコード体系の整備
- 一貫性のあるエラーコード体系を定義
- エラーメッセージの多言語対応
- クライアント側でのエラーハンドリングのガイドライン
-->

## ガイドライン

<!-- TODO(!documentation): API使用ガイドラインの追加
- ユースケースごとのAPI使用例
- パフォーマンス最適化のためのベストプラクティス
- レート制限などの制約事項
-->

## バージョン管理

<!-- TODO(!documentation): 変更履歴の管理
- API変更の追跡と履歴管理
- バージョン管理方針のドキュメント化
- 破壊的変更の事前通知プロセス
-->

## セットアップガイド

<!-- TODO(!documentation): セットアップガイドの改善
- 開発環境のセットアップ手順の詳細化
- トラブルシューティングガイドの追加
- CI/CD環境の設定ガイド
-->

## ユーザードキュメント

<!-- TODO(!documentation): 操作マニュアルの作成
- エンドユーザー向け機能説明
- 管理者向け操作マニュアル
- よくある質問（FAQ）の整備
-->

## アーキテクチャドキュメント

<!-- TODO(!documentation): アーキテクチャドキュメントの更新
- システム全体のアーキテクチャ図の作成
- コンポーネント間の依存関係の可視化
- 拡張ポイントとプラグイン機構の説明
-->

## データベース関連

- [x] データベース接続エラーハンドリングの改善
- [x] テストデータベースの初期化問題を解決
- [x] MySQL 8.0との互換性問題（tx_isolationなど）を解決
- [x] Ridgepole設定の最適化
- [ ] データベースシードデータの整備と自動ロード機能
- [ ] テスト環境でのデータベースパフォーマンス向上
- [ ] Docker環境での接続安定性のさらなる向上
- [ ] クラウドデータベースサービスとの互換性対応

## パフォーマンス改善

- [ ] N+1クエリの検出と修正
- [ ] ActiveRecordクエリのパフォーマンス最適化
- [ ] バルクインサートとバルクアップデートの実装
- [ ] キャッシュ戦略の改善
- [ ] フロントエンドのレンダリングパフォーマンス向上

## テスト環境

- [x] テスト環境でのデータベーススキーマ適用問題を解決
- [x] テスト失敗時の自動リカバリー機能の実装
- [x] FactoryBotの初期化と安定性の向上
- [ ] テスト実行時間の短縮（並列テスト実行の安定化）
- [ ] フィーチャーテストの実装とE2Eテスト環境の構築
- [ ] CIパイプラインでのテスト実行の高速化

## Docker環境

- [x] MySQLコンテナの安定性向上
- [x] MySQL設定の最適化
- [x] APIコンテナへのmysql-clientインストール
- [ ] ボリュームマウントの最適化
- [ ] 開発環境と本番環境の設定差異の最小化
- [ ] マルチステージビルドの最適化

## セキュリティ

- [ ] 依存パッケージの脆弱性スキャンと更新
- [ ] APIエンドポイントの認証・認可の強化
- [ ] SQLインジェクション対策の徹底
- [ ] CSRFトークンの実装
- [ ] セキュリティヘッダーの設定
- [ ] 環境変数とシークレット管理の改善

## Railsアップグレード対応

- [x] Rails 8互換性対応（autoload_libsなど）
- [ ] deprecated警告の解消
- [ ] ActiveRecordの新機能活用
- [ ] CSSとJSのアセットパイプライン最適化
- [ ] トレース機能とロギング強化

## ドキュメント

- [x] テスト環境の安定性向上ガイドの作成
- [ ] APIドキュメントの整備（Swagger/OpenAPI）
- [ ] 開発環境セットアップガイドの更新
- [ ] デプロイメントプロセスのドキュメント化
- [ ] アーキテクチャ設計書の作成

## リファクタリング

- [ ] コントローラーの責務分離
- [ ] サービスオブジェクトパターンの導入
- [ ] バリデーションとエラーハンドリングの一元化
- [ ] ポリシーオブジェクトによる認可ロジックの分離
- [ ] イベントシステムの実装

## インフラストラクチャ

- [ ] CI/CDパイプラインの改善
- [ ] コンテナオーケストレーションの導入
- [ ] ロギングとモニタリングの強化
- [ ] バックアップと復旧プロセスの自動化
- [ ] スケーリング戦略の実装

## 残タスク（優先度高）

1. テスト環境でのデータベーススキーマ適用の安定性向上
   - データベースブートストラップの見直し
   - エラーハンドリングの強化
   - リカバリー機能の改善

2. MySQLバージョン互換性の完全対応
   - transaction_isolation設定の環境検出改善
   - MySQLクライアントツールのコンテナ内利用
   - 接続設定の最適化

3. テスト並列実行時の安定性向上
   - データベース接続プールの最適化
   - DatabaseCleanerの設定改善
   - トランザクション分離レベルのチューニング 