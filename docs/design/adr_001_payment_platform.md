# ADR-001: 決済基盤の選定

## ステータス
Accepted

## 作成日
2025-04-30

## 作成者
決済チーム

## レビュー
- テックリード
- セキュリティ担当
- プロダクトマネージャー

## 関連ドキュメント
- [リスクレジスター](../product/risk_register.md) (R-01, R-02)
- [API リファレンス](../specifications/api_reference.md)

## コンテキスト
eventa では有料チケット販売を行うため、クレジットカードおよび国内決済手段（コンビニ / キャリア決済等）への対応が必須となる。
PCI DSS への準拠コストを最小化し、短期間で MVP をローンチしたい。
将来的に海外発行カードや多通貨決済へ拡張する可能性がある。
支払い失敗時のリトライ、チャージバック対策、レポート機能も重視する。

## 決定
- Stripe Checkout をメイン決済プロバイダーとして採用する。
- 国内独自決済手段（コンビニ払込・PayPay 等）は Pay.jp のマルチペイメント API を併用する。
- カード情報はトークン化し、サーバー側では保持しない（PCI DSS SAQ A 適用）。

## 決定理由
- **開発速度**: Stripe の Checkout SDK は最短数時間で統合可能。Pay.jp も Ruby SDK が公式提供されている。
- **機能網羅性**: Stripe は多通貨・サブスクリプション・定期請求に対応。Pay.jp は国内コンビニ・ATM・キャリア決済に対応。
- **手数料**: Stripe (3.6%) + Pay.jp (3.6%) は業界標準的な水準。
- **セキュリティ**: 両社とも PCI DSS Level 1 認定済み、SDK 利用で認定スコープ最小化可能。
- **運用コスト**: 両社ともダッシュボード GUI とレポート機能が充実。

## 代替案と比較
### 代替案 1: PayPal のみ使用
- メリット: 海外ユーザー認知度高い、実装容易
- デメリット: 国内決済手段の網羅性低い、UX が古い、独自ルールが多い

### 代替案 2: 自社実装 + 銀行振込
- メリット: 手数料削減可能、完全カスタマイズ可能
- デメリット: PCI DSS 準拠コスト大、開発工数大、運用負荷増

## 影響
- **導入工数**: バックエンド 3人日 + フロントエンド 2人日
- **コスト**: 初期費用なし、月額固定費なし、決済時手数料のみ (3.6%)
- **保守性**: SDK/API に依存するため定期的な更新が必要

## 懸念点
- Stripe/Pay.jp がサービス終了・大幅仕様変更した場合の移行コスト
- 決済処理が中央依存となるため、それらのサービス障害時は決済不可となる点 