# ユーザー新規登録機能テスト計画書

**ドキュメントバージョン**: 1.0  
**最終更新日**: 2023-10-01  
**機能ID**: USER-REG-001  
**テスト担当**: QA Team

## 1. テスト範囲

本テスト計画は、Eventaプラットフォームのユーザー新規登録機能に関するテスト戦略と実施項目を定義します。

### 1.1 テスト対象コンポーネント

- バックエンド
  - ユーザーモデル
  - 認証コントローラー（登録アクション）
  - バリデーションロジック
  - JWT発行機能

- フロントエンド
  - 登録ページ (`/register` または `/signup`)
  - フォームコンポーネント
  - バリデーション処理
  - API連携処理
  - 認証コンテキスト連携

### 1.2 対象外範囲

- 既存ユーザーのログイン機能
- パスワードリセット機能
- ユーザープロフィール管理
- ソーシャルログイン連携（将来実装予定）

## 2. テスト戦略

### 2.1 テストレベル

1. **単体テスト**: コンポーネントごとの機能テスト
2. **統合テスト**: コンポーネント間の連携テスト
3. **E2Eテスト**: エンドツーエンドの利用フローテスト
4. **負荷テスト**: 高負荷状況での安定性テスト
5. **セキュリティテスト**: 脆弱性テスト

### 2.2 テスト環境

- **開発環境**: 開発者によるローカルテスト
- **テスト環境**: 自動テスト実行環境
- **ステージング環境**: 受け入れテスト環境
- **本番環境**: 最終確認

### 2.3 テストデータ

- 有効なユーザーデータセット
- 無効なデータパターン
- 境界値データ
- 特殊文字を含むデータ

## 3. テスト項目

### 3.1 バックエンドテスト

#### 3.1.1 ユーザーモデルテスト

| ID | テスト項目 | 前提条件 | 入力 | 期待結果 |
|----|----------|---------|------|---------|
| UT-01 | 有効なユーザー作成 | なし | 全ての必須項目が有効 | ユーザー作成成功 |
| UT-02 | メール必須 | なし | メール空 | バリデーションエラー |
| UT-03 | メール形式 | なし | 不正なメール形式 | バリデーションエラー |
| UT-04 | メール一意性 | 同じメールの既存ユーザー | 重複メール | バリデーションエラー |
| UT-05 | パスワード長 | なし | 7文字以下のパスワード | バリデーションエラー |
| UT-06 | 名前必須 | なし | 名前空 | バリデーションエラー |
| UT-07 | ロール値 | なし | 不正なロール値 | バリデーションエラー |

#### 3.1.2 認証コントローラーテスト

| ID | テスト項目 | 前提条件 | 入力 | 期待結果 |
|----|----------|---------|------|---------|
| CT-01 | 正常登録 | なし | 有効なユーザーデータ | 201 Created, ユーザーとトークン返却 |
| CT-02 | バリデーションエラー | なし | 無効なデータ | 422 Unprocessable Entity, エラーメッセージ |
| CT-03 | メール重複 | 既存ユーザー | 重複メール | 422, 重複エラーメッセージ |
| CT-04 | サーバーエラー処理 | DB接続エラー状態 | 有効なデータ | 500, 適切なエラーハンドリング |

### 3.2 フロントエンドテスト

#### 3.2.1 コンポーネントテスト

| ID | テスト項目 | 前提条件 | 入力/アクション | 期待結果 |
|----|----------|---------|--------------|---------|
| FC-01 | フォーム初期表示 | なし | ページロード | 全フィールド初期値表示 |
| FC-02 | フィールドバリデーション | なし | フォーカス外し | リアルタイムバリデーション |
| FC-03 | フォーム送信バリデーション | なし | 無効データで送信クリック | エラーメッセージ表示、送信停止 |
| FC-04 | 送信中状態 | なし | 有効データで送信クリック | ローディング表示 |
| FC-05 | パスワード強度表示 | なし | パスワード入力 | 強度インジケーター更新 |

#### 3.2.2 E2Eテスト

| ID | テスト項目 | 前提条件 | 入力/アクション | 期待結果 |
|----|----------|---------|--------------|---------|
| E2E-01 | 登録成功フロー | なし | 有効データで送信 | アカウント作成、ログイン状態、リダイレクト |
| E2E-02 | バリデーションエラー表示 | なし | 無効データで送信 | エラーメッセージ表示、修正可能 |
| E2E-03 | サーバーエラー表示 | APIエラー状態 | 有効データで送信 | エラーメッセージ表示、再試行可能 |
| E2E-04 | メール重複処理 | 既存メール | 重複メールで送信 | 重複エラー表示、修正可能 |

### 3.3 セキュリティテスト

| ID | テスト項目 | 前提条件 | 入力/アクション | 期待結果 |
|----|----------|---------|--------------|---------|
| ST-01 | SQLインジェクション | なし | メールフィールドにSQL注入 | インジェクション失敗、適切なエスケープ |
| ST-02 | XSS脆弱性 | なし | スクリプトをフォームに入力 | スクリプト実行不可、適切なエスケープ |
| ST-03 | CSRF保護 | なし | 外部からのフォーム送信 | リクエスト拒否 |
| ST-04 | レート制限 | なし | 短時間に多数のリクエスト | 制限後のリクエスト拒否 |
| ST-05 | パスワードセキュリティ | なし | ハッシュ化確認 | DB内パスワードがハッシュ化 |

### 3.4 負荷テスト

| ID | テスト項目 | 前提条件 | 入力/アクション | 期待結果 |
|----|----------|---------|--------------|---------|
| LT-01 | 同時複数ユーザー登録 | なし | 100ユーザー同時登録 | 全て成功、レスポンスタイム<2秒 |
| LT-02 | 大量登録処理 | なし | 1000ユーザー連続登録 | システム安定性維持 |
| LT-03 | DB接続プール適正化 | なし | 高負荷状態での登録処理 | 接続エラーなし |

## 4. テスト自動化

### 4.1 単体テスト自動化

- **バックエンド**: RSpec
  ```ruby
  # ユーザーモデルテスト例
  RSpec.describe User, type: :model do
    it "validates presence of email" do
      user = User.new(name: "テスト", password: "password123", role: "guest")
      expect(user.valid?).to be false
      expect(user.errors[:email]).to include("can't be blank")
    end
  end
  ```

- **フロントエンド**: Jest, React Testing Library
  ```javascript
  // フォームコンポーネントテスト例
  test('shows validation error for invalid email', async () => {
    render(<RegisterForm />);
    
    fireEvent.change(screen.getByLabelText(/メールアドレス/i), {
      target: { value: 'invalid-email' },
    });
    
    fireEvent.blur(screen.getByLabelText(/メールアドレス/i));
    
    expect(await screen.findByText(/有効なメールアドレス/i)).toBeInTheDocument();
  });
  ```

### 4.2 E2Eテスト自動化

- **ツール**: Cypress
  ```javascript
  // 登録成功フローテスト例
  describe('User Registration', () => {
    it('allows a new user to register', () => {
      cy.visit('/register');
      
      cy.get('[name=email]').type('test@example.com');
      cy.get('[name=name]').type('テストユーザー');
      cy.get('[name=password]').type('password123');
      cy.get('[name=password_confirmation]').type('password123');
      cy.get('[name=role][value=guest]').check();
      cy.get('[name=terms_accepted]').check();
      
      cy.get('button[type=submit]').click();
      
      // 登録成功、リダイレクト確認
      cy.url().should('include', '/events');
      cy.get('[data-testid=user-menu]').should('contain', 'テストユーザー');
    });
  });
  ```

## 5. バグ管理

### 5.1 バグ報告テンプレート

```
タイトル: [コンポーネント] 問題の簡潔な説明

再現手順:
1. ステップ1
2. ステップ2
3. ステップ3

期待動作: 
実際の動作:

環境情報:
- ブラウザ/バージョン:
- OS:
- 画面サイズ:

スクリーンショット/動画:
(添付)

追加情報:
(関連するコンソールエラーなど)
```

### 5.2 バグ重大度レベル

| レベル | 定義 | 例 |
|-------|-----|-----|
| P0 | クリティカル | 登録機能が完全に動作しない |
| P1 | 高 | 特定条件下で登録できない、データが保存されない |
| P2 | 中 | UIの問題、一部バリデーションの不具合 |
| P3 | 低 | 見た目の軽微な問題、改善提案 |

## 6. テスト実施計画

### 6.1 スケジュール

| フェーズ | 開始日 | 終了日 | 担当 |
|---------|-------|-------|-----|
| テスト計画策定 | 2023-10-01 | 2023-10-02 | QA Team |
| 単体テスト実装 | 2023-10-03 | 2023-10-06 | 開発者 |
| 統合テスト実装 | 2023-10-07 | 2023-10-10 | QA Team |
| E2Eテスト実装 | 2023-10-11 | 2023-10-13 | QA Team |
| セキュリティテスト | 2023-10-14 | 2023-10-15 | Security Team |
| 負荷テスト | 2023-10-16 | 2023-10-17 | Infrastructure Team |
| バグ修正期間 | 2023-10-18 | 2023-10-20 | 開発者 |
| 最終検証 | 2023-10-21 | 2023-10-22 | QA Team |

### 6.2 リソース配分

- QAエンジニア: 2名
- 開発者（バックエンド）: 1名
- 開発者（フロントエンド）: 1名
- セキュリティ担当: 1名
- インフラ担当: 1名（負荷テスト時）

## 7. 受け入れ基準

1. 全ての必須機能要件が実装され、動作すること
2. 全ての単体テストが成功すること（カバレッジ80%以上）
3. 全ての統合テストが成功すること
4. E2Eテストで主要フローが確認できること
5. P0、P1レベルのバグが残っていないこと
6. セキュリティテストで重大な脆弱性が検出されないこと
7. 負荷テストで定義された性能基準を満たすこと
8. コードレビューで承認されていること

## 8. リスクと対策

| リスク | 影響度 | 対策 |
|-------|-------|-----|
| DB接続障害 | 高 | リトライメカニズム、エラー通知 |
| APIレート制限による誤検知 | 中 | テスト用レート制限緩和、十分な間隔 |
| テストデータ競合 | 中 | テスト毎の一意なデータセット |
| 環境差異 | 低 | Docker環境での統一テスト環境 |

## 9. テスト成果物

- テスト計画書（本ドキュメント）
- テストケース仕様書
- 自動テストコード
- テスト実行結果レポート
- バグレポート
- 最終テスト報告書

---

## 改訂履歴

| 日付 | バージョン | 変更内容 | 担当者 |
|------|----------|---------|--------|
| 2023-10-01 | 1.0 | 初版作成 | QA Team | 