name: "TODO to Issue"

# TODO(!enhancement): 複数ラベル対応を追加する（例: TODO(!urgent !backend): のような形式）
# alstr/todo-to-issue-action が対応しているか確認するか、カスタムパーサーの実装を検討する

# TODO: 定期実行（scheduled）を追加して、一定期間ごとにコードベースをスキャンして Issue 化することを検討する

on:
  push:
    branches: [ main, develop ]
    paths-ignore:
      # 自動生成ファイルや頻繁に変更されるファイルを除外
      - '**/*.lock'
      - '**/*.md'

jobs:
  todo:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 差分検出のために完全履歴が必要

      # TODOコメントをIssue化
      - name: Convert TODO / FIXME to Issues
        uses: alstr/todo-to-issue-action@v5
        with:
          TOKEN: ${{ secrets.GITHUB_TOKEN }}
          COMMENT_PATTERN: 'TODO|FIXME|OPTIMIZE|HACK|NOTE'  # 拡張キーワード
          LABEL: 'todo'
          CLOSE_ISSUES: true
          AUTO_ASSIGN: 'kota-suzu'  # チームのデフォルト担当者（必要に応じて変更）
          INCLUDE_PATTERN: '*.rb|*.js|*.jsx|*.ts|*.tsx|*.yml|*.yaml|Makefile|Dockerfile*|*.css|*.scss|*.html|*.erb'  # コード関連ファイルのみ対象

# TODO: スケジュール実行の追加を検討する
# 定期的に全コードベースをスキャンし、漏れなくTODOコメントをIssue化する 